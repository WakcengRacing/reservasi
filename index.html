<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Reservasi Ruangan Kelas</title>
    <!-- Link ke Bootstrap CSS melalui CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link ke SweetAlert2 CSS melalui CDN -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.7/dist/sweetalert2.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h1 class="text-center text-primary mb-4">Sistem Reservasi Ruangan Kelas</h1>

        <!-- Daftar Ruangan dan Pencarian -->
        <section id="room-list" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="h5 text-dark">Daftar Ruangan</div>
                <div>
                    <label for="filter-date" class="form-label">Filter Tanggal:</label>
                    <input type="date" id="filter-date" class="form-control d-inline-block w-auto">
                    <button onclick="filterRooms()" class="btn btn-primary mt-2">Tampilkan Ruangan Tersedia</button>
                </div>
            </div>
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Nomor Ruangan</th>
                        <th>Kapasitas</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="room-list-body">
                    <!-- Daftar ruangan akan ditampilkan di sini -->
                </tbody>
            </table>
        </section>

        <!-- Formulir Reservasi -->
        <section id="reservation-form" class="mb-5">
            <h2 class="text-center text-dark">Formulir Reservasi</h2>
            <form id="reserve-form">
                <div class="mb-3">
                    <label for="name" class="form-label">Nama Pemesan:</label>
                    <input type="text" id="name" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="room-number" class="form-label">Nomor Ruangan:</label>
                    <input type="number" id="room-number" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="date" class="form-label">Tanggal Reservasi:</label>
                    <input type="date" id="date" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="start-time" class="form-label">Waktu Mulai:</label>
                    <input type="time" id="start-time" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="duration" class="form-label">Durasi (jam):</label>
                    <input type="number" id="duration" class="form-control" min="1" required>
                </div>

                <button type="submit" class="btn btn-success w-100">Pesan Ruangan</button>
            </form>
            <p id="error-message" class="text-danger mt-2"></p>
        </section>

        <!-- Daftar Reservasi -->
        <section id="reservation-list">
            <h2 class="text-center text-dark mb-4">Daftar Reservasi</h2>
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Nama Pemesan</th>
                        <th>Nomor Ruangan</th>
                        <th>Tanggal Reservasi</th>
                        <th>Waktu Mulai</th>
                        <th>Durasi</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="reservation-list-body">
                    <!-- Daftar reservasi akan ditampilkan di sini -->
                </tbody>
            </table>
        </section>
    </div>

    <!-- Script JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.7/dist/sweetalert2.all.min.js"></script>
    <script>
        // Kelas untuk Ruangan
        class Room {
            constructor(number, capacity) {
                this.number = number;
                this.capacity = capacity;
                this.reservations = []; // Daftar reservasi untuk ruangan ini
            }

            isAvailable(startTime, duration) {
                const start = new Date(`1970-01-01T${startTime}:00`);
                const end = new Date(start.getTime() + duration * 60 * 60 * 1000); // Durasi dalam milidetik

                for (let reservation of this.reservations) {
                    const resStart = new Date(`1970-01-01T${reservation.startTime}:00`);
                    const resEnd = new Date(resStart.getTime() + reservation.duration * 60 * 60 * 1000);
                    if ((start < resEnd) && (end > resStart)) {
                        return false; // Ada konflik
                    }
                }

                return true; // Tidak ada konflik
            }

            addReservation(reservation) {
                this.reservations.push(reservation);
            }
        }

        // Kelas untuk Reservasi
        class Reservation {
            constructor(name, roomNumber, date, startTime, duration) {
                this.name = name;
                this.roomNumber = roomNumber;
                this.date = date;
                this.startTime = startTime;
                this.duration = duration;
            }
        }

        // Daftar ruangan yang ada
        const rooms = [
            new Room(1, 30),
            new Room(2, 25),
            new Room(3, 20),
            new Room(4, 20),
            new Room(5, 25),
            new Room(6, 20),
        ];

        // Daftar untuk menyimpan semua reservasi
        const reservations = [];

        // Fungsi untuk menampilkan daftar ruangan
        function displayRooms() {
            const roomListBody = document.getElementById("room-list-body");
            roomListBody.innerHTML = '';

            rooms.forEach(room => {
                const row = document.createElement("tr");
                const status = room.reservations.length === 0 ? "Tersedia" : "Tidak Tersedia";
                row.innerHTML = `
                    <td>${room.number}</td>
                    <td>${room.capacity}</td>
                    <td>${status}</td>
                `;
                roomListBody.appendChild(row);
            });
        }

        // Fungsi untuk menampilkan daftar reservasi
        function displayReservations() {
            const reservationListBody = document.getElementById("reservation-list-body");
            reservationListBody.innerHTML = '';

            reservations.forEach(reservation => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${reservation.name}</td>
                    <td>${reservation.roomNumber}</td>
                    <td>${reservation.date}</td>
                    <td>${reservation.startTime}</td>
                    <td>${reservation.duration} jam</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="cancelReservation('${reservation.name}', ${reservation.roomNumber}, '${reservation.date}', '${reservation.startTime}')">Batalkan</button>
                    </td>
                `;
                reservationListBody.appendChild(row);
            });
        }

        // Fungsi untuk melakukan reservasi
        document.getElementById("reserve-form").addEventListener("submit", function(e) {
            e.preventDefault();

            const name = document.getElementById("name").value;
            const roomNumber = parseInt(document.getElementById("room-number").value);
            const date = document.getElementById("date").value;
            const startTime = document.getElementById("start-time").value;
            const duration = parseInt(document.getElementById("duration").value);

            const room = rooms.find(room => room.number === roomNumber);
            if (room && room.isAvailable(startTime, duration)) {
                const reservation = new Reservation(name, roomNumber, date, startTime, duration);
                room.addReservation(reservation);
                reservations.push(reservation);
                displayRooms();
                displayReservations();
                document.getElementById("reserve-form").reset();
                document.getElementById("error-message").textContent = '';

                // Menampilkan SweetAlert2 ketika reservasi berhasil
                Swal.fire({
                    title: 'Reservasi Berhasil!',
                    text: `Ruangan ${roomNumber} berhasil dipesan.`,
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            } else {
                document.getElementById("error-message").textContent = 'Ruangan sudah dipesan pada waktu ini.';
            }
        });

        // Fungsi untuk membatalkan reservasi
        function cancelReservation(name, roomNumber, date, startTime) {
            Swal.fire({
                title: 'Apakah Anda yakin?',
                text: `Anda ingin membatalkan reservasi untuk ${name} di ruangan ${roomNumber} pada ${date} pukul ${startTime}?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ya, Batalkan',
                cancelButtonText: 'Tidak, Kembali'
            }).then(result => {
                if (result.isConfirmed) {
                    // Batalkan reservasi
                    const room = rooms.find(room => room.number === roomNumber);
                    room.reservations = room.reservations.filter(res => 
                        !(res.name === name && res.roomNumber === roomNumber && res.date === date && res.startTime === startTime)
                    );
                    reservations.splice(reservations.findIndex(res => 
                        res.name === name && res.roomNumber === roomNumber && res.date === date && res.startTime === startTime
                    ), 1);

                    displayRooms();
                    displayReservations();

                    // Menampilkan SweetAlert2 setelah pembatalan
                    Swal.fire({
                        title: 'Reservasi Dibatalkan!',
                        text: `Reservasi untuk ${name} di ruangan ${roomNumber} telah dibatalkan.`,
                        icon: 'success',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        // Fungsi untuk filter ruangan berdasarkan tanggal
        function filterRooms() {
            const filterDate = document.getElementById("filter-date").value;
            const availableRooms = rooms.filter(room => {
                return room.reservations.every(reservation => reservation.date !== filterDate);
            });

            const roomListBody = document.getElementById("room-list-body");
            roomListBody.innerHTML = '';

            availableRooms.forEach(room => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${room.number}</td>
                    <td>${room.capacity}</td>
                    <td>Tersedia</td>
                `;
                roomListBody.appendChild(row);
            });
        }

        // Inisialisasi tampilan awal
        displayRooms();
        displayReservations();
    </script>

    <!-- Link ke Bootstrap JS melalui CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
